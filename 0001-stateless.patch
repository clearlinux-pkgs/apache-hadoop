From f753deea1f91a9a73cda39b83c71cd08f424283e Mon Sep 17 00:00:00 2001
From: Athenas Jimenez Gonzalez <athenas.jimenez.gonzalez@intel.com>
Date: Wed, 26 Apr 2017 23:03:33 +0000
Subject: [PATCHv2] stateless for apache-hadoop

---
 .../hadoop-common/src/main/bin/hadoop-config.sh           | 15 +++++++++++----
 1 file changed, 11 insertions(+), 4 deletions(-)

diff --git a/hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh b/hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh
index 980f4b6..70993aa 100644
--- a/hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh
+++ b/hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh
@@ -100,12 +100,19 @@ HADOOP_LOGLEVEL="${HADOOP_LOGLEVEL:-INFO}"
  
 # Allow alternate conf dir location.
 if [ -e "${HADOOP_PREFIX}/conf/hadoop-env.sh" ]; then
-  DEFAULT_CONF_DIR="conf"
+  DEFAULT_CONF_DIR="$HADOOP_PREFIX/conf"
+elif [ -e "/etc/hadoop" ]; then
+  DEFAULT_CONF_DIR="/etc/hadoop"
+  if [ -z "$(ls -A /etc/hadoop)" ]; then
+      echo \
+          "Error: Directory /etc/hadoop is empty"
+      exit 1
+  fi
 else
-  DEFAULT_CONF_DIR="etc/hadoop"
+  DEFAULT_CONF_DIR="/usr/share/defaults/hadoop"
 fi
 
-export HADOOP_CONF_DIR="${HADOOP_CONF_DIR:-$HADOOP_PREFIX/$DEFAULT_CONF_DIR}"
+export HADOOP_CONF_DIR="${HADOOP_CONF_DIR:-$DEFAULT_CONF_DIR}"
 
 # User can specify hostnames or a file where the hostnames are (not both)
 if [[ ( "$HADOOP_SLAVES" != '' ) && ( "$HADOOP_SLAVE_NAMES" != '' ) ]] ; then
@@ -218,7 +225,7 @@ CLASSPATH=${CLASSPATH}:$HADOOP_COMMON_HOME/$HADOOP_COMMON_DIR'/*'
 
 # default log directory & file
 if [ "$HADOOP_LOG_DIR" = "" ]; then
-  HADOOP_LOG_DIR="$HADOOP_PREFIX/logs"
+  HADOOP_LOG_DIR="/var/log/hadoop"
 fi
 if [ "$HADOOP_LOGFILE" = "" ]; then
   HADOOP_LOGFILE='hadoop.log'
-- 
2.12.2

